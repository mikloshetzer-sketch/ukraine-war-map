name: Inspect DeepState data folder

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  inspect:
    runs-on: ubuntu-latest
    steps:
      - name: Install jq
        run: |
          set -euo pipefail
          sudo apt-get update
          sudo apt-get install -y jq

      - name: List files in cyterat/deepstate-map-data/data
        env:
          API_URL: https://api.github.com/repos/cyterat/deepstate-map-data/contents/data
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          set -euo pipefail
          echo "Listing: $API_URL"

          curl -sS -L \
            -H "Accept: application/vnd.github+json" \
            -H "User-Agent: gh-actions" \
            -H "Authorization: Bearer $GH_TOKEN" \
            "$API_URL" > listing.json

          echo "== File names (filtered) =="
          jq -r '.[].name' listing.json | sort | head -n 200

          echo ""
          echo "== Hints: files containing keywords =="
          echo "-- occupied/occupation:"
          jq -r '.[].name' listing.json | grep -i "occup" || true
          echo "-- contested/disputed/grey/gray:"
          jq -r '.[].name' listing.json | egrep -i "contest|disput|grey|gray" || true
          echo "-- frontline/line/front:"
          jq -r '.[].name' listing.json | egrep -i "front|line" || true
          echo "-- ukraine/ua:"
          jq -r '.[].name' listing.json | egrep -i "ukr|ua" || true
