<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ukrán–orosz háború – interaktív térkép (DeepState)</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; }

    .panel {
      position: absolute;
      z-index: 1000;
      top: 12px;
      left: 12px;
      right: 12px;
      max-width: 520px;
      background: rgba(255,255,255,0.95);
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      font: 13px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    .legend {
      position: absolute;
      bottom: 20px;
      left: 12px;
      z-index: 1000;
      background: rgba(255,255,255,0.95);
      padding: 10px;
      border-radius: 10px;
      font-size: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    }

    .legend div { margin-bottom: 4px; }

    .color-box {
      width: 12px;
      height: 12px;
      display: inline-block;
      margin-right: 6px;
      border-radius: 3px;
    }

    .chip {
      background: #f2f2f2;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
    }

    .btn {
      border: 0;
      border-radius: 10px;
      padding: 8px 10px;
      background: #111;
      color: #fff;
      cursor: pointer;
      font-size: 12px;
    }
  </style>
</head>

<body>
<div id="map"></div>

<div class="panel">
  <b>Ukrán–orosz háború – DeepState térkép</b><br>
  <small>Napi frissítés GitHub Actions-ből</small><br><br>

  <label class="chip">
    <input id="toggleDeepState" type="checkbox" checked />
    DeepState réteg
  </label>

  <button id="zoomBtn" class="btn">Rázoomolás</button>

  <div style="margin-top:8px;font-size:12px;">
    Forrás: <span id="sourceFile">betöltés...</span>
  </div>
</div>

<div class="legend">
  <b>Jelmagyarázat</b><br>
  <div><span class="color-box" style="background:#d00;"></span>Frontvonal</div>
  <div><span class="color-box" style="background:#ff7b00;"></span>Vitatott terület</div>
  <div><span class="color-box" style="background:#7f0000;"></span>Orosz megszállás</div>
  <div><span class="color-box" style="background:#0057ff;"></span>Ukrán ellenőrzés</div>
</div>

<script>
const map = L.map('map').setView([49.0, 31.0], 6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '&copy; OpenStreetMap'
}).addTo(map);

let deepStateLayer;

function styleByStatus(feature) {
  const p = feature.properties || {};
  const status = (p.status || "").toLowerCase();

  if (status.includes("occupied") || status.includes("russia"))
    return { color:"#7f0000", fillColor:"#7f0000", weight:1, fillOpacity:0.3 };

  if (status.includes("contested"))
    return { color:"#ff7b00", fillColor:"#ff7b00", weight:1, fillOpacity:0.3 };

  if (status.includes("ukraine"))
    return { color:"#0057ff", fillColor:"#0057ff", weight:1, fillOpacity:0.3 };

  return { color:"#d00", weight:2 };
}

fetch('./data/deepstate_latest.geojson')
  .then(r => r.json())
  .then(data => {
    deepStateLayer = L.geoJSON(data, {
      style: styleByStatus,
      onEachFeature: (f, layer) => {
        const p = f.properties || {};
        layer.bindPopup(
          "<b>DeepState adat</b><br>" +
          (p.name || "") + "<br>" +
          (p.status || "")
        );
      }
    }).addTo(map);

    map.fitBounds(deepStateLayer.getBounds());
  });

document.getElementById("zoomBtn").onclick = () => {
  if (deepStateLayer) map.fitBounds(deepStateLayer.getBounds());
};

document.getElementById("toggleDeepState").onchange = (e) => {
  if (e.target.checked) map.addLayer(deepStateLayer);
  else map.removeLayer(deepStateLayer);
};

fetch('./data/deepstate_latest.source.txt')
  .then(r => r.text())
  .then(t => document.getElementById("sourceFile").innerText = t);
</script>
</body>
</html>
